<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>UFC Toto Demo — 관리자 + 실시간 로그</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white min-h-screen flex flex-col">

<header class="w-full bg-gray-800 p-4 text-center text-white font-bold cursor-pointer" id="headerTitle">UFC</header>

<!-- 로그인 페이지 -->
<div id="loginPage" class="flex items-center justify-center min-h-screen bg-gray-900 text-white">
  <form id="loginForm" class="bg-gray-800 p-6 rounded-lg shadow-lg">
    <h2 class="text-xl font-bold mb-4 text-center">로그인</h2>
    <input type="text" id="username" placeholder="이름" class="w-full p-2 mb-2 text-black rounded">
    <input type="text" id="userid" placeholder="고유번호" class="w-full p-2 mb-2 text-black rounded">
    <div id="loginError" class="text-red-400 text-sm mb-3 hidden"></div>
    <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 p-2 rounded font-bold">로그인</button>
  </form>
</div>

<!-- 연령 확인 모달 -->
<div id="ageModal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center hidden">
  <div class="bg-gray-800 p-6 rounded-2xl shadow-lg text-center w-[min(560px,92vw)]">
    <h2 class="text-xl font-bold mb-4">연령 확인</h2>
    <p class="mb-6 text-gray-300">본 서비스는 만 19세 이상만 이용 가능합니다.</p>
    <div class="flex justify-center space-x-4">
      <button id="confirmAge" type="button" class="px-4 py-2 bg-green-600 rounded-xl hover:bg-green-500">만 19세 이상입니다</button>
      <button id="exitSite" type="button" class="px-4 py-2 bg-red-600 rounded-xl hover:bg-red-500">나가기</button>
    </div>
  </div>
</div>

<!-- 메인 배팅 페이지 -->
<main id="mainApp" class="flex-1 p-6 grid place-items-center hidden">
  <div class="bg-gray-800 rounded-2xl shadow-lg p-6 w-full max-w-md">
    <h2 class="text-xl font-semibold mb-4 text-center">다가오는 경기</h2>
    <p class="text-center mb-6">선수 A vs 선수 B</p>

    <div class="flex justify-around mb-4">
      <div class="text-center">
        <img src="https://picsum.photos/100/100?random=1" class="mx-auto mb-2 rounded-full">
        <p class="font-bold">선수 A</p>
        <p class="text-green-400 text-lg">배당률: <span id="oddsA">2.20</span></p>
        <button id="btnBetA" class="mt-2 px-4 py-2 bg-red-600 rounded-xl hover:bg-red-500">A에게 배팅</button>
      </div>
      <div class="text-center">
        <img src="https://picsum.photos/100/100?random=2" class="mx-auto mb-2 rounded-full">
        <p class="font-bold">선수 B</p>
        <p class="text-green-400 text-lg">배당률: <span id="oddsB">1.90</span></p>
        <button id="btnBetB" class="mt-2 px-4 py-2 bg-blue-600 rounded-xl hover:bg-blue-500">B에게 배팅</button>
      </div>
    </div>

    <label class="block mb-2">계좌번호</label>
    <input id="betAccount" type="text" class="w-full p-2 rounded-lg text-black mb-2" placeholder="계좌번호 입력">

    <div class="mb-4">
      <label class="block mb-2">라운드 선택:</label>
      <select id="roundSelect" class="w-full p-2 rounded-lg text-black mb-2">
        <option value="1">라운드 1</option>
        <option value="2">라운드 2</option>
        <option value="3">라운드 3</option>
        <option value="4">라운드 4</option>
        <option value="5">라운드 5</option>
      </select>
      <label class="block mb-2">베팅 금액 (₩):</label>
      <input id="betAmount" type="number" class="w-full p-2 rounded-lg text-black mb-2" placeholder="금액 입력" />
      <div class="flex justify-between mb-2">
        <button class="betQuick px-2 py-1 bg-gray-600 rounded" data-value="50000000">5천만</button>
        <button class="betQuick px-2 py-1 bg-gray-600 rounded" data-value="100000000">1억</button>
        <button class="betQuick px-2 py-1 bg-gray-600 rounded" data-value="500000000">5억</button>
        <button class="betQuick px-2 py-1 bg-gray-600 rounded" data-value="1000000000">10억</button>
      </div>
    </div>

    <div class="bg-gray-700 p-4 rounded-lg mb-4">
      <p>선택한 선수: <span id="selectedFighter">없음</span></p>
      <p>배당률: <span id="selectedOdds">-</span></p>
      <p>라운드: <span id="selectedRound">-</span></p>
      <p class="mt-2 font-semibold">예상 당첨금: <span id="payout">0</span> 원</p>
    </div>

    <div class="mt-4 flex gap-2">
      <button id="placeBet" class="flex-1 px-4 py-2 bg-emerald-500 rounded-xl font-bold">모의 배팅</button>
      <button id="logoutBtn" class="px-4 py-2 bg-gray-600 rounded-xl">로그아웃</button>
    </div>
  </div>
</main>

<!-- 배팅 결과 페이지 -->
<main id="betResultPage" class="flex-1 p-6 grid place-items-center hidden">
  <div class="bg-gray-800 rounded-2xl shadow-lg p-6 w-full max-w-md text-center">
    <h2 class="text-xl font-semibold mb-4">배팅 결과</h2>
    <p>선택한 선수: <span id="resultFighter"></span></p>
    <p>라운드: <span id="resultRound"></span></p>
    <p>배팅 금액: <span id="resultBetAmount"></span> 원</p>
    <p>배당률: <span id="resultOdds"></span></p>
    <p>수수료(20%): <span id="resultFee"></span> 원</p>
    <p class="font-bold mt-2">예상 수령금: <span id="resultPayout"></span> 원</p>
    <button id="backToMain" class="mt-4 px-4 py-2 bg-blue-600 rounded-xl">메인으로</button>
  </div>
</main>

<script>
const MAX_BET = 1000000000;
let adminInterval;

const loginPage = document.getElementById('loginPage');
const loginForm = document.getElementById('loginForm');
const ageModal = document.getElementById('ageModal');
const mainApp = document.getElementById('mainApp');
const betResultPage = document.getElementById('betResultPage');
const loginError = document.getElementById('loginError');
const oddsA = document.getElementById('oddsA');
const oddsB = document.getElementById('oddsB');
const btnBetA = document.getElementById('btnBetA');
const btnBetB = document.getElementById('btnBetB');
const selectedFighterEl = document.getElementById('selectedFighter');
const selectedOddsEl = document.getElementById('selectedOdds');
const selectedRoundEl = document.getElementById('selectedRound');
const payoutEl = document.getElementById('payout');
const betAmountEl = document.getElementById('betAmount');
const placeBet = document.getElementById('placeBet');
const logoutBtn = document.getElementById('logoutBtn');
const roundSelect = document.getElementById('roundSelect');
const backToMain = document.getElementById('backToMain');
const betAccountEl = document.getElementById('betAccount');

// 로그인
loginForm.addEventListener('submit', e=>{
  e.preventDefault();
  const name = document.getElementById('username').value.trim();
  const id = document.getElementById('userid').value.trim();

  if(name==="관리자" && id==="1"){ 
    localStorage.setItem('ufc_admin','true'); 
    showAdminPage(); 
    return; 
  }

  if(name && id){
    localStorage.setItem('ufo_demo_user', JSON.stringify({name,id}));
    loginPage.classList.add('hidden');
    ageModal.classList.remove('hidden');
    loginError.classList.add('hidden');
  } else {
    loginError.textContent = '이름, 고유번호를 모두 입력하세요.';
    loginError.classList.remove('hidden');
  }
});

document.getElementById('confirmAge').addEventListener('click', ()=>{
  localStorage.setItem('ufo_demo_age_confirmed','true');
  ageModal.classList.add('hidden'); 
  mainApp.classList.remove('hidden');
});
document.getElementById('exitSite').addEventListener('click', ()=>{window.location.href='about:blank';});
logoutBtn.addEventListener('click', ()=>{ 
  localStorage.removeItem('ufo_demo_user'); 
  localStorage.removeItem('ufo_demo_age_confirmed'); 
  location.reload(); 
});

// 선수 선택
function selectBet(fighter, odds){
  selectedFighterEl.textContent = fighter;
  selectedOddsEl.textContent = parseFloat(odds).toFixed(2);
  selectedRoundEl.textContent = roundSelect.value;
  calculatePayout();
}
btnBetA.addEventListener('click', ()=>selectBet('선수 A', oddsA.textContent));
btnBetB.addEventListener('click', ()=>selectBet('선수 B', oddsB.textContent));

// 배팅 금액 버튼
document.querySelectorAll('.betQuick').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    let value = parseInt(btn.dataset.value);
    let current = parseInt(betAmountEl.value||0);
    if(current + value > MAX_BET) current = MAX_BET;
    else current += value;
    betAmountEl.value = current;
    calculatePayout();
  });
});

function calculatePayout(){
  const amount=parseFloat(betAmountEl.value||0);
  const odds=parseFloat(selectedOddsEl.textContent||0);
  payoutEl.textContent = (!isNaN(amount)&&amount>0&&!isNaN(odds)&&odds>0)?(amount*odds).toLocaleString():'0';
}

function canBetOnRound(round){
  const history = JSON.parse(localStorage.getItem('ufo_demo_bets')||'[]');
  const savedUser = JSON.parse(localStorage.getItem('ufo_demo_user'));
  return !history.some(bet=>bet.user.id===savedUser.id && bet.round==round);
}

// 배팅 실행
placeBet.addEventListener('click', ()=>{
  const saved = localStorage.getItem('ufo_demo_user');
  if(!saved){ alert('먼저 로그인하세요.'); return; }
  const user = JSON.parse(saved);

  const account = betAccountEl.value.trim();
  if(!account){ alert('계좌번호를 입력하세요.'); return; }

  const fighter = selectedFighterEl.textContent;
  const amount = parseFloat(betAmountEl.value||0);
  const odds = parseFloat(selectedOddsEl.textContent||0);
  const round = parseInt(roundSelect.value);
  
  if(!fighter || fighter==='없음' || amount<=0 || odds<=0){ alert('선수 선택 및 금액 확인'); return; }
  if(amount>MAX_BET){ alert('최대 배팅 금액은 10억입니다.'); return; }
  if(!canBetOnRound(round)){ alert(`라운드 ${round}에는 이미 배팅했습니다.`); return; }

  const rawPayout = amount*odds;
  const fee = Math.floor(rawPayout*0.2);
  const finalPayout = rawPayout - fee;

  const history = JSON.parse(localStorage.getItem('ufo_demo_bets')||'[]');
  history.push({user:{...user, account}, fighter, round, amount, odds, payout:finalPayout, fee, time:new Date().toISOString()});
  localStorage.setItem('ufo_demo_bets',JSON.stringify(history));

  document.getElementById('resultFighter').textContent = fighter;
  document.getElementById('resultRound').textContent = round;
  document.getElementById('resultBetAmount').textContent = amount.toLocaleString();
  document.getElementById('resultOdds').textContent = odds.toFixed(2);
  document.getElementById('resultFee').textContent = fee.toLocaleString();
  document.getElementById('resultPayout').textContent = finalPayout.toLocaleString();

  mainApp.classList.add('hidden');
  betResultPage.classList.remove('hidden');

  selectedFighterEl.textContent='없음';
  selectedOddsEl.textContent='-';
  selectedRoundEl.textContent='-';
  betAmountEl.value='';
  payoutEl.textContent='0';
  betAccountEl.value='';
});

backToMain.addEventListener('click', ()=>{
  betResultPage.classList.add('hidden');
  mainApp.classList.remove('hidden');
});

// 관리자 테이블 렌더
function renderAdminTable() {
  const tbody = document.getElementById('bettingLog');
  if(!tbody) return;
  tbody.innerHTML = '';
  const bets = JSON.parse(localStorage.getItem('ufo_demo_bets')||'[]');
  bets.forEach((bet,i)=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td class="border p-2">${bet.user.name}</td>
      <td class="border p-2">${bet.user.id}</td>
      <td class="border p-2">${bet.user.account}</td>
      <td class="border p-2">${bet.fighter}</td>
      <td class="border p-2">${bet.odds}</td>
      <td class="border p-2">${bet.round}</td>
      <td class="border p-2">${bet.amount.toLocaleString()}</td>
      <td class="border p-2">${bet.payout.toLocaleString()}</td>
      <td class="border p-2">${bet.fee.toLocaleString()}</td>
      <td class="border p-2 text-center"><input type="checkbox" data-index="${i}"></td>`;
    tbody.appendChild(tr);
  });
}

// 관리자 실시간 갱신
function startAdminRefresh(){
  adminInterval = setInterval(()=>{
    const tbody = document.getElementById('bettingLog');
    if(tbody) renderAdminTable();
    else clearInterval(adminInterval);
  }, 2000);
}

function showAdminPage(){
  document.body.innerHTML = `<header class="w-full bg-gray-800 p-4 text-center text-white font-bold cursor-pointer" id="headerTitle">UFC</header>
  <div class="p-4 bg-gray-900 text-white min-h-screen">
  <h1 class="text-2xl font-bold mb-4">관리자 페이지</h1>
  <table class="w-full border border-gray-700">
    <thead><tr class="bg-gray-800"><th class="p-2">사용자</th><th class="p-2">고유번호</th><th class="p-2">계좌</th><th class="p-2">선수</th><th class="p-2">배당률</th><th class="p-2">라운드</th><th class="p-2">베팅 금액</th><th class="p-2">지급 금액</th><th class="p-2">수수료(20%)</th><th class="p-2">선택</th></tr></thead>
    <tbody id="bettingLog"></tbody>
  </table>
  <div class="mt-4 flex gap-2">
    <button id="deleteSelected" class="px-4 py-2 bg-red-600 rounded-xl flex-1">선택 삭제</button>
    <button id="deleteAll" class="px-4 py-2 bg-red-700 rounded-xl flex-1">전체 삭제</button>
    <button id="adminLogout" class="px-4 py-2 bg-gray-600 rounded-xl flex-1">로그아웃</button>
  </div>
  </div>`;

  renderAdminTable();
  startAdminRefresh();

  document.getElementById('deleteSelected').addEventListener('click', ()=>{
    clearInterval(adminInterval);
    const checkboxes = document.querySelectorAll('#bettingLog input[type="checkbox"]:checked');
    let history = JSON.parse(localStorage.getItem('ufo_demo_bets')||'[]');
    const removeIndexes = Array.from(checkboxes).map(cb=>parseInt(cb.dataset.index)).sort((a,b)=>b-a);
    removeIndexes.forEach(idx=>history.splice(idx,1));
    localStorage.setItem('ufo_demo_bets',JSON.stringify(history));
    showAdminPage();
  });

  document.getElementById('deleteAll').addEventListener('click', ()=>{
    clearInterval(adminInterval);
    if(confirm('정말 전체 로그를 삭제하시겠습니까?')){
      localStorage.removeItem('ufo_demo_bets');
      showAdminPage();
    }
  });

  document.getElementById('adminLogout').addEventListener('click', ()=>{
    clearInterval(adminInterval);
    localStorage.removeItem('ufc_admin'); location.reload();
  });
}

// 초기 로딩
(function(){
  const saved = localStorage.getItem('ufo_demo_user');
  if(saved){
    loginPage.classList.add('hidden');
    const ageConfirmed = localStorage.getItem('ufo_demo_age_confirmed');
    if(ageConfirmed){ mainApp.classList.remove('hidden'); } else { ageModal.classList.remove('hidden'); }
  }
})();
</script>
</body>
</html>
